<html>

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width">
</head>

<body>
    <h2>Using the XMLHttpRequest Object</h2>
    <div id="demo">
        <button type="button" onclick="loadXMLDoc()">Change Content</button>
    </div>
    <script>
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('/hls-sw/sw.js', { scope: '/hls-sw' }).then(
                function (registration) {
                    // Registration was successful
                    if (registration.installing) {
                        console.log('Service worker installing')
                    } else if (registration.waiting) {
                        console.log('Service worker installed')
                    } else if (registration.active) {
                        console.log('Service worker active')
                    }

                    setTimeout(() => {
                        var xhttp = new XMLHttpRequest()
                        xhttp.responseType = 'arraybuffer'
                        xhttp.onreadystatechange = function () {
                            if (this.readyState == 4 && this.status == 200) {
                                alert('done ' + this.response.byteLength)
                            } else if (this.readyState == 4 && this.status != 200) {
                                alert('error')
                            }
                        }
                        xhttp.open(
                            'GET',
                            'https://lh3.googleusercontent.com/d/1kF-84rtQi6BCQYKbxMN6VYJ7Zg3VhsZb=s0',
                            true
                        )
                        xhttp.setRequestHeader('Range', 'bytes=100-1000')
                        xhttp.send()
                    }, 2000)
                },
                function (err) {
                    // registration failed :(
                    alert('fail ' + err.message)
                    console.log('ServiceWorker registration failed: ', err)
                }
            )
        }

        function loadXMLDoc() {
            var xhttp = new XMLHttpRequest()
            xhttp.responseType = 'arraybuffer'
            xhttp.onreadystatechange = function () {
                if (this.readyState == 4 && this.status == 200) {
                    alert('done ' + this.response.byteLength)
                } else if (this.readyState == 4 && this.status != 200) {
                    alert('error')
                }
            }
            xhttp.open(
                'GET',
                'https://lh3.googleusercontent.com/d/1kF-84rtQi6BCQYKbxMN6VYJ7Zg3VhsZb=s0?b',
                true
            )
            xhttp.setRequestHeader('Range', 'bytes=100-1000')
            xhttp.send()
        }
    </script>
</body>

</html>